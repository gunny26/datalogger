<html>
<head>
<!--jquery itself-->
<script type="text/javascript" src="jquery-2.1.3.js"></script>
<!--highcharts graphics engine-->
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
</head>
<body>
<script>
$(document).ready(function(){
    // set some meaningful default values
    $("#project").val("vicenter");
    $("#tablename").val("virtualMachineNetworkStats");
    $("#servername").val("srvpralki1.tilak.cc");
    $("#instance").val("5305cfcc-8b500331-071a-0025b511004f")
    $("#datestring").val("2015-05-31")
    var searchkeys = $(location).attr('search').slice(1).split("&")
    searchkeys.forEach(function (data) {
        console.log(data);
        var key = data.split("=")[0];
        var value = data.split("=")[1];
        console.log("Key  : " + key);
        console.log("Value: " + value);
        $("#" + key).val(value);
    });
    console.log("search parameter:" + searchkeys);
    $("#clickme").click(function() {
        alert("hadler for .click() called,keyids=" + $("#keyids").val());
    });
    $("#getData").click(function() {
        getData();
    });
});

function draw_network(hostname, instance, droppedRx, droppedTx, received, transmitted, usage) {
    $('#container').highcharts({
        chart: {
            type: 'spline'
        },
        title: {
            text: 'Network Interface Statistics of interface '+ instance + " on " + hostname
        },
        subtitle: {
            text: 'in kb/s'
        },
        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { // don't display the dummy year
                month: '%e. %b',
                year: '%b'
            },
            title: {
                text: 'Date'
            }
        },
        yAxis: {
            title: {
                text: 'kb/s'
            },
            min: 0
        },
        tooltip: {
            headerFormat: '<b>{series.name}</b><br>',
            pointFormat: '{point.x:%e. %b}: {point.y:.2f} m'
        },

        plotOptions: {
            spline: {
                marker: {
                    enabled: false
                }
            }
        },

        series: [{
            name: 'droppedRx',
            data: droppedRx,
        },
        {
            name: 'droppedTx',
            data: droppedTx,
        },
        {
            name: 'received',
            data: received,
        },
        {
            name: 'transmitted',
            data: transmitted,
        },
        {
            name: 'usage',
            data: usage,
        },
        ]
    });
}

function getData() {
    var project = $("#project").val();
    var tablename = $("#tablename").val();
    var datestring = $("#datestring").val();
    var servername = $("#servername").val();
    var instance = $("#instance").val()
    var url = "http://srvmghomer.tilak.cc/datalogger/RawData/getVicenterTimeseries/" + tablename + "/" + datestring + "/" + servername + "/" +instance;
    var droppedRx = [];
    var droppedTx = [];
    var received = [];
    var transmitted = [];
    var usage = [];
    console.log("Getting Data from url " + url);
    $.getJSON(url).then(function(data) {
        document.body.style.cursor = "wait";
        // data is already javascript not json
        // use only item 3 in array, and convert to int
        data.forEach(function(row) {
            var ts = new Date((parseInt(row[0]) + 7200) * 1000); //has to be new and multiplied by 1000
            droppedRx.push([ts, parseInt(row[1])]);
            droppedTx.push([ts, parseInt(row[2])]);
            received.push([ts, parseInt(row[3])]);
            transmitted.push([ts, parseInt(row[4])]);
            usage.push([ts, parseInt(row[5])]);
        })
        draw_network(servername, instance, droppedRx, droppedTx, received, transmitted, usage);
        document.body.style.cursor = "default";
    });
}

</script>
<h1>Network Statistics</h1>
<div>Project    : <input id="project" type=text value="vicenter"></div>
<div>Tablename  : <input id="tablename" type=text value=""></div>
<div>Servername : <input id="servername" type=text value=""></div>
<div>Instance   : <input id="instance" type=text value=""></div>
<div>Datestring : <input id="datestring" type="text"></div>
<div id="getData">click here to fetch data</div>
<div id="container" style="min-width: 310px; height: 400px; margin: 0 auto">There will be data after you clicked fetch</div>
</body>
</html>
